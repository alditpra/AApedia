---
const navLinks = [
  { href: "/", label: "Home" },
  { 
    href: "/layanan", 
    label: "Layanan",
    children: [
      { label: "AAPEDIA PUBLISH", href: "/layanan/publish", desc: "Web & Jurnal Hosting" },
      { label: "AAPEDIA COMPUTE", href: "/layanan/compute", desc: "Digital Ocean / AWS EC2" },
      { label: "AAPEDIA INTELLIGENCE", href: "/layanan/intelligence", desc: "GPU AI & Training" },
      { label: "AAPEDIA FLEXBILL", href: "/layanan/flexbill", desc: "Jasa Bayar Cloud" },
    ]
  },
  { href: "/tentang", label: "Tentang Kami" },
  { href: "/kontak", label: "Kontak" },
];

const currentPath = Astro.url.pathname;
---

<header class="fixed top-0 left-0 right-0 z-50 navbar-blur border-b border-slate-200/50">
  <nav class="max-w-7xl mx-auto px-6 py-4">
    <div class="flex items-center justify-between">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-3 group">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary-600 to-accent-500 flex items-center justify-center shadow-lg shadow-primary-500/30 group-hover:scale-105 transition-transform">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" />
          </svg>
        </div>
        <span class="text-xl font-bold text-gradient">AApedia</span>
      </a>

      <!-- Desktop Nav -->
      <div class="hidden md:flex items-center gap-8">
        {navLinks.map((link) => (
          link.children ? (
            <div class="relative group">
              <button 
                aria-label="Toggle Layanan Dropdown"
                aria-expanded="false"
                aria-haspopup="true"
                class={`dropdown-toggle flex items-center gap-1 text-sm font-medium transition-colors hover:text-primary-600 ${
                  currentPath.startsWith(link.href) ? 'text-primary-600' : 'text-slate-600'
                }`}
              >
                {link.label}
                <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
              </button>
              
              <!-- Dropdown Menu -->
              <div class="absolute top-full left-1/2 -translate-x-1/2 pt-4 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 ease-out transform group-hover:translate-y-0 translate-y-2">
                <div class="w-64 bg-white rounded-xl shadow-xl border border-slate-100 overflow-hidden p-2">
                  {link.children.map((child) => (
                    <a 
                      href={child.href}
                      class="block px-4 py-3 rounded-lg hover:bg-slate-50 transition-colors"
                    >
                      <p class="text-sm font-semibold text-slate-800">{child.label}</p>
                      <p class="text-xs text-slate-500">{child.desc}</p>
                    </a>
                  ))}
                  <div class="border-t border-slate-100 mt-2 pt-2">
                    <a 
                      href="/layanan"
                      class="block px-4 py-2 rounded-lg hover:bg-primary-50 transition-colors text-center"
                    >
                      <p class="text-sm font-semibold text-primary-600">Lihat Semua Layanan →</p>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          ) : (
            <a 
              href={link.href} 
              class={`text-sm font-medium transition-colors hover:text-primary-600 ${
                currentPath === link.href ? 'text-primary-600' : 'text-slate-600'
              }`}
            >
              {link.label}
            </a>
          )
        ))}
      </div>

      <!-- CTA Button -->
      <a href="/kontak" class="hidden md:inline-flex btn-primary text-sm">
        Mulai Konsultasi
      </a>

      <!-- Mobile Menu Button -->
      <button 
        id="mobile-menu-btn" 
        aria-label="Toggle Navigation Menu" 
        aria-expanded="false"
        aria-controls="mobile-menu"
        class="md:hidden p-2 text-slate-600 hover:text-primary-600"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div 
      id="mobile-menu" 
      class="hidden md:hidden mt-4 pb-4 border-t border-slate-200/50 pt-4"
      role="navigation"
      aria-label="Mobile Navigation"
    >
      <div class="flex flex-col gap-3">
        {navLinks.map((link) => (
          link.children ? (
             <div class="bg-slate-50 rounded-xl p-3">
                <p class="text-xs font-bold text-primary-600 px-2 mb-2 uppercase tracking-wider">{link.label}</p>
                <div class="space-y-1">
                  {link.children.map(child => (
                    <a 
                      href={child.href} 
                      class={`block px-3 py-3 rounded-lg text-sm font-medium transition-colors ${
                        currentPath === child.href 
                          ? 'bg-primary-600 text-white' 
                          : 'text-slate-700 hover:bg-white hover:shadow-sm'
                      }`}
                    >
                      <div class="font-semibold text-sm">{child.label}</div>
                      <div class="text-xs opacity-75 mt-0.5">{child.desc}</div>
                    </a>
                  ))}
                  <a 
                    href="/layanan"
                    class="block px-3 py-3 rounded-lg text-sm font-medium transition-colors border-t border-slate-200 mt-2 pt-3 text-center text-primary-600 hover:bg-white hover:shadow-sm"
                  >
                    <div class="font-semibold text-sm">Lihat Semua Layanan →</div>
                  </a>
                </div>
             </div>
          ) : (
            <a 
              href={link.href} 
              class={`block px-4 py-3 text-base font-medium rounded-lg transition-colors ${
                currentPath === link.href 
                  ? 'bg-primary-600 text-white' 
                  : 'text-slate-700 hover:bg-slate-50'
              }`}
            >
              {link.label}
            </a>
          )
        ))}
        <a href="/kontak" class="btn-primary text-sm text-center mt-2 py-3">
          Mulai Konsultasi
        </a>
      </div>
    </div>
  </nav>
</header>

<script>
  // Mobile menu toggle with ARIA state management
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  
  menuBtn?.addEventListener('click', () => {
    const isExpanded = menuBtn.getAttribute('aria-expanded') === 'true';
    menuBtn.setAttribute('aria-expanded', String(!isExpanded));
    mobileMenu?.classList.toggle('hidden');
  });

  // Desktop dropdown hover with ARIA management
  document.querySelectorAll('.dropdown-toggle').forEach(btn => {
    const parent = btn.closest('.group');
    if (!parent) return;
    
    parent.addEventListener('mouseenter', () => {
      btn.setAttribute('aria-expanded', 'true');
    });
    
    parent.addEventListener('mouseleave', () => {
      btn.setAttribute('aria-expanded', 'false');
    });
  });
</script>
